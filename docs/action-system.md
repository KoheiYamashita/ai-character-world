# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

## æ¦‚è¦

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç”Ÿæ´»ã‚’é€šã˜ã¦è¨˜æ†¶ã‚’å½¢æˆã™ã‚‹ãŸã‚ã®ä¸–ç•Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã€‚
å¨¯æ¥½ã¨ã—ã¦ã®æ¥½ã—ã•ã§ã¯ãªãã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ä½“é¨“ã¨è¨˜æ†¶è“„ç©ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

## è¨­è¨ˆæ€æƒ³

å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯ã€Œè¡Œå‹•ã®ãƒˆãƒªã‚¬ãƒ¼ã€ã¨ã—ã¦æ©Ÿèƒ½ã—ã€äºˆæœŸã—ãªã„ç§»å‹•ã‚„å‡ºä¼šã„ã‚’ç”Ÿã¿å‡ºã™:

- satiety â†’ é£Ÿäº‹ã«è¡Œã â†’ å¤–é£Ÿå…ˆã§å‡ºä¼šã„
- energy â†’ ä¼‘æ†©ãƒ»ç¡çœ  â†’ å ´æ‰€ã§ã®ä½“é¨“
- bladder â†’ è¡Œå‹•ä¸­æ–­ â†’ äºˆæœŸã—ãªã„ç§»å‹•ãƒ»å‡ºä¼šã„
- hygiene â†’ å…¥æµ´ â†’ å¤§æµ´å ´ãƒ»æ¸©æ³‰ã§ã®å‡ºä¼šã„
- mood â†’ è¡Œå‹•é¸æŠãƒ»ä¼šè©±å“è³ªã«å½±éŸ¿
- money â†’ ä»•äº‹ãƒ»æ¶ˆè²»è¡Œå‹•ã®ãƒˆãƒªã‚¬ãƒ¼

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | ç¯„å›² | è¨˜æ†¶å½¢æˆã¸ã®å½¹å‰² |
|-----------|------|------|-----------------|
| satiety | æº€è…¹åº¦ | 0-100 | é£Ÿäº‹è¡Œå‹• â†’ å¤–é£Ÿã§å‡ºä¼šã„ |
| energy | ä½“åŠ›/ç–²åŠ´ | 0-100 | ç¡çœ ãƒ»ä¼‘æ†© â†’ å ´æ‰€ã§ã®ä½“é¨“ |
| hygiene | è¡›ç”Ÿ | 0-100 | å…¥æµ´è¡Œå‹• â†’ å¤§æµ´å ´ãƒ»æ¸©æ³‰ã§å‡ºä¼šã„ |
| mood | æ°—åˆ† | 0-100 | è¡Œå‹•é¸æŠãƒ»ä¼šè©±å“è³ªã«å½±éŸ¿ |
| bladder | ãƒˆã‚¤ãƒ¬æ¬²æ±‚ | 0-100 | è¡Œå‹•ä¸­æ–­ â†’ ãƒ©ãƒ³ãƒ€ãƒ ãªç§»å‹•ãƒ»å‡ºä¼šã„ |
| money | æ‰€æŒé‡‘ | 0ä»¥ä¸Š | ä»•äº‹ãƒ»æ¶ˆè²»è¡Œå‹•ã®ãƒˆãƒªã‚¬ãƒ¼ |

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

### ç”Ÿå­˜æ¬²æ±‚ (Survival)

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¿…è¦æ–½è¨­ | æ–™é‡‘ | åŠ¹æœ | è¨˜æ†¶å½¢æˆ |
|-----------|---------|------|------|---------|
| eat | kitchen (è‡ªå®…) | é£Ÿæè²» | satiety â†‘ | æ—¥å¸¸ã®è¨˜éŒ² |
| eat | restaurant | æ–½è¨­æ–™é‡‘ | satiety â†‘ | å ´æ‰€ãƒ»å‡ºä¼šã„ã®ä½“é¨“ |
| sleep | bedroom (è‡ªå®…) | 0 | energy å…¨å›å¾© | æ—¥ã®åŒºåˆ‡ã‚Š |
| sleep | bedroom + hotel | æ–½è¨­æ–™é‡‘ | energy å…¨å›å¾© | å ´æ‰€ã®è¨˜æ†¶ |
| toilet | toilet | 0 | bladder â†‘ | è¡Œå‹•ä¸­æ–­ã«ã‚ˆã‚‹å¶ç™ºçš„ä½“é¨“ |

### ç”Ÿæ´»ç¶­æŒ (Daily Life)

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¿…è¦æ–½è¨­ | æ–™é‡‘ | åŠ¹æœ | è¨˜æ†¶å½¢æˆ |
|-----------|---------|------|------|---------|
| work | workspace | - | money â†‘, satiety â†“, energy â†“ | ä»•äº‹å ´ã§ã®ä½“é¨“ |
| bathe | bathroom (è‡ªå®…) | 0 | hygiene â†‘ | æ—¥å¸¸ã®è¨˜éŒ² |
| bathe | bathroom + hotel | æ–½è¨­æ–™é‡‘ | hygiene â†‘ | å ´æ‰€ã®è¨˜æ†¶ |
| bathe | hotspring | æ–½è¨­æ–™é‡‘ | hygiene â†‘, mood â†‘ | å‡ºä¼šã„ãƒ»ä½“é¨“ |

### ç¤¾ä¼šæ´»å‹• (Social)

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¿…è¦æ–½è¨­ | æ–™é‡‘ | åŠ¹æœ | è¨˜æ†¶å½¢æˆ |
|-----------|---------|------|------|---------|
| talk | - (NPCè¿‘ã) | 0 | NPCå¥½æ„Ÿåº¦å¤‰åŒ– | **æœ€é‡è¦**: ä¼šè©±ã«ã‚ˆã‚‹è¨˜æ†¶ |

### ä½™æš‡ (Leisure)

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¿…è¦æ–½è¨­ | æ–™é‡‘ | åŠ¹æœ | è¨˜æ†¶å½¢æˆ |
|-----------|---------|------|------|---------|
| rest | - | 0 | mood â†‘, energy å¾®å›å¾© | å ´æ‰€ã§ã®ä½“é¨“ |

### ç§»å‹• (Movement)

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¿…è¦æ–½è¨­ | æ–™é‡‘ | åŠ¹æœ | è¨˜æ†¶å½¢æˆ |
|-----------|---------|------|------|---------|
| move | - | 0 | ä½ç½®ç§»å‹• | ã€Œã©ã“ã«è¡Œã£ãŸã€ã®è¨˜éŒ² |

#### ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ç§»å‹•

LLMã®è¡Œå‹•æ±ºå®šã¨ã¯åˆ¥ã«ã€ã‚·ã‚¹ãƒ†ãƒ ãŒå®šæœŸçš„ã«moveã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºå‹•ã™ã‚‹:

- **ç™ºå‹•æ¡ä»¶**: 3å›ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†ã”ã¨ï¼ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼‰
- **è¡Œãå…ˆ**: 3ãƒãƒƒãƒ—ä»¥å†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå ´æ‰€
- **ç›®çš„**: åŒã˜å ´æ‰€ã«ç•™ã¾ã‚‹ã“ã¨ã‚’é˜²ãã€å¶ç™ºçš„ãªå‡ºä¼šã„ã®å‰µå‡º

```
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº† â†’ ã‚«ã‚¦ãƒ³ãƒˆ+1
  â†“
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰²ã‚Šè¾¼ã¿åˆ¤å®šï¼ˆã„ãšã‚Œã‹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ < 10%ï¼‰
  â†“ YES â†’ ç·Šæ€¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚«ã‚¦ãƒ³ãƒˆã¯é€²ã‚€ãŒmoveã‚¹ã‚­ãƒƒãƒ—ï¼‰
  â†“ NO
ã‚«ã‚¦ãƒ³ãƒˆ == 3?
  â”œâ”€ YES â†’ 3ãƒãƒƒãƒ—ä»¥å†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå ´æ‰€ã¸è‡ªå‹•move â†’ ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ
  â””â”€ NO â†’ LLMãŒæ¬¡ã®è¡Œå‹•ã‚’æ±ºå®š
```

## æ–½è¨­ã‚·ã‚¹ãƒ†ãƒ 

### æ–½è¨­ã‚¿ã‚° (FacilityTag)

```typescript
type FacilityTag =
  | "bathroom"      // æµ´å®¤
  | "kitchen"       // ã‚­ãƒƒãƒãƒ³
  | "bedroom"       // å¯å®¤
  | "toilet"        // ãƒˆã‚¤ãƒ¬
  | "restaurant"    // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³
  | "workspace"     // ä»•äº‹å ´
  | "hotspring"     // æ¸©æ³‰
  | "hotel"         // ãƒ›ãƒ†ãƒ«
  | "public"        // å…¬å…±
```

### æ–½è¨­æƒ…å ±

```typescript
interface FacilityInfo {
  tags: FacilityTag[]
  owner?: string           // æ‰€æœ‰è€…IDï¼ˆè‡ªå®…åˆ¤å®šç”¨ï¼‰
  cost?: number            // åˆ©ç”¨æ–™é‡‘ï¼ˆ0 = ç„¡æ–™ï¼‰
  quality?: number         // å“è³ªï¼ˆåŠ¹æœé‡ã«å½±éŸ¿ï¼‰
  job?: JobInfo            // ä»•äº‹æƒ…å ±ï¼ˆworkspaceã®å ´åˆï¼‰
}
```

### maps.jsonã§ã®æ–½è¨­å®šç¾©

æ–½è¨­æƒ…å ±ã¯ `public/data/maps.json` ã® obstacles é…åˆ—å†…ã« `facility` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦å®šç¾©ã™ã‚‹ã€‚

### è‡ªå®…ã®æ–½è¨­æ§‹æˆ

è‡ªå®…ã¯å…¨åŸºæœ¬ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å…ˆã¨ã—ã¦ã€ä»¥ä¸‹ã®æ–½è¨­ã‚¿ã‚°ã‚’æŒã¤:

| æ–½è¨­ã‚¿ã‚° | ç”¨é€” | å‚™è€ƒ |
|---------|------|------|
| bedroom | ç¡çœ  | å¯å®¤ |
| kitchen | é£Ÿäº‹ | èª¿ç†å° |
| bathroom | å…¥æµ´ | æµ´å®¤ |
| toilet | ãƒˆã‚¤ãƒ¬ | ãƒˆã‚¤ãƒ¬ |
| workspace | ä»•äº‹ | ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ |

```json
{
  "id": "home",
  "name": "è‡ªå®…",
  "obstacles": [
    {
      "label": "å¯å®¤",
      "type": "zone",
      "facility": { "tags": ["bedroom"], "owner": "character_alice" }
    },
    {
      "label": "èª¿ç†å°",
      "facility": { "tags": ["kitchen"], "owner": "character_alice" }
    },
    {
      "label": "æµ´å®¤",
      "facility": { "tags": ["bathroom"], "owner": "character_alice" }
    },
    {
      "label": "ãƒˆã‚¤ãƒ¬",
      "facility": { "tags": ["toilet"], "owner": "character_alice" }
    },
    {
      "label": "ãƒ‡ã‚¹ã‚¯",
      "facility": { "tags": ["workspace"], "owner": "character_alice" }
    }
  ]
}
```

### ãã®ä»–ã®æ–½è¨­ä¾‹

```json
{
  "label": "æ¸©æ³‰",
  "type": "zone",
  "facility": {
    "tags": ["bathroom", "hotspring", "public"],
    "cost": 500,
    "quality": 80
  }
}
```

### æ–½è¨­ã®æ¤œç´¢

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§åˆ©ç”¨å¯èƒ½ãªæ–½è¨­ã‚’æ¤œç´¢:

1. **æ¤œç´¢ç¯„å›²**: ç¾åœ¨åœ°ã‹ã‚‰3ãƒãƒƒãƒ—ä»¥å†…ï¼ˆentranceçµŒç”±ã®ãƒ›ãƒƒãƒ—æ•°ã§ã‚«ã‚¦ãƒ³ãƒˆï¼‰
2. **ãƒãƒƒãƒãƒ³ã‚°**: `requirements.facilityTags`ã¨ç…§åˆï¼ˆANDæ¡ä»¶: ã™ã¹ã¦ã®ã‚¿ã‚°ãŒå¿…è¦ï¼‰
3. **æ‰€æœ‰æ¨©**: `ownership: "self"`ã®å ´åˆã€`facility.owner`ãŒã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼IDã¨ä¸€è‡´
4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: è©²å½“æ–½è¨­ãŒãªã‘ã‚Œã°è‡ªå®…ã‚’ä½¿ç”¨
5. **æç¤º**: æ–™é‡‘ãƒ»å“è³ªãƒ»ç§»å‹•è·é›¢ã‚’LLMã«æç¤ºã—ã€é¸æŠã•ã›ã‚‹

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¡ä»¶

- **å®Ÿè¡Œå¯èƒ½æ¡ä»¶**: å¯¾å¿œã™ã‚‹æ–½è¨­ã‚¿ã‚°ã‚’æŒã¤Zoneã«å…¥ã‚‹ã“ã¨
  - ä¾‹: `bedroom`ã‚¿ã‚°ã‚’æŒã¤Zoneå†…ã«ã„ã‚Œã°`sleep`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¯èƒ½
  - ä¾‹: `kitchen`ã‚¿ã‚°ã‚’æŒã¤Zoneå†…ã«ã„ã‚Œã°`eat_home`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¯èƒ½
- **å®Ÿè¡Œä¸­ã®ç§»å‹•**: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ã¯ç§»å‹•ä¸å¯ï¼ˆãã®å ´ã«ç•™ã¾ã‚‹ï¼‰
- **å®Ÿè¡Œä¸­ã®è¡¨ç¤º**: é ­ä¸Šã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—ã‚’è¡¨ç¤º

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆé ­ä¸Šçµµæ–‡å­—ï¼‰

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çŠ¶æ…‹ã‚’é ­ä¸Šã®çµµæ–‡å­—ã§è¡¨ç¾:

| çŠ¶æ…‹ | çµµæ–‡å­— | èª¬æ˜ |
|------|--------|------|
| LLMæ€è€ƒä¸­ | ğŸ¤” | è¡Œå‹•æ±ºå®šå¾…ã¡ |
| ä¼šè©±ä¸­ | ğŸ’¬ | NPCã¨ã®ä¼šè©±ä¸­ |
| é£Ÿäº‹ä¸­ | ğŸ½ï¸ | eatã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| ç¡çœ ä¸­ | ğŸ˜´ | sleepã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| å…¥æµ´ä¸­ | ğŸ› | batheã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| ä»•äº‹ä¸­ | ğŸ’¼ | workã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| ãƒˆã‚¤ãƒ¬ä¸­ | ğŸš» | toiletã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| ä¼‘æ†©ä¸­ | â˜• | restã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ |
| ç§»å‹•ä¸­ | ğŸš¶ | moveã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ï¼ˆä»»æ„ï¼‰ |

```
ä¾‹: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç”ºã«ã„ã¦ç©ºè…¹ã®å ´åˆ

åˆ©ç”¨å¯èƒ½ãªé£Ÿäº‹å ´æ‰€:
- ã‚«ãƒ•ã‚§ ãƒ‰ãƒ«ãƒã‚§ (1ãƒãƒƒãƒ—, 800å††, å“è³ª70)
- å–«èŒ¶ ã¤ã°ã‚ (1ãƒãƒƒãƒ—, 600å††, å“è³ª65)
- ã‚³ãƒ³ãƒ“ãƒ‹ (1ãƒãƒƒãƒ—, 400å††, å“è³ª40)
- è‡ªå®…ã‚­ãƒƒãƒãƒ³ (1ãƒãƒƒãƒ—, 300å††, å“è³ª50)
```

## ä»•äº‹ã‚·ã‚¹ãƒ†ãƒ 

### ä»•äº‹æƒ…å ±

```typescript
interface JobInfo {
  jobId: string
  title: string           // "ã‚¦ã‚§ã‚¤ã‚¿ãƒ¼", "æ–™ç†äºº"
  hourlyWage: number      // æ™‚çµ¦
  workHours: {            // å–¶æ¥­æ™‚é–“ï¼ˆã“ã®æ™‚é–“å†…ã®ã¿åƒã‘ã‚‹ï¼‰
    start: number         // 9 (æ™‚)
    end: number           // 22 (æ™‚)
  }
}
```

### è·å ´å®šç¾©ä¾‹

```json
{
  "label": "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
  "type": "zone",
  "facility": {
    "tags": ["restaurant", "workspace"],
    "job": {
      "jobId": "waiter",
      "title": "ã‚¦ã‚§ã‚¤ã‚¿ãƒ¼",
      "hourlyWage": 1000,
      "workHours": { "start": 10, "end": 22 }
    }
  }
}
```

### é›‡ç”¨çŠ¶æ…‹

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«é›‡ç”¨çŠ¶æ…‹ã‚’æŒãŸã›ã‚‹ã€‚è¤‡æ•°ã®è·å ´ã§åƒã‘ã‚‹ã‚ˆã†ã«é…åˆ—ã§ç®¡ç†ã€‚

```typescript
interface WorkplaceInfo {
  workplaceLabel: string  // è·å ´åï¼ˆè¡¨ç¤ºç”¨ï¼‰
  mapId: string           // è·å ´ãŒã‚ã‚‹ãƒãƒƒãƒ—ID
}

interface Employment {
  jobId: string
  workplaces: WorkplaceInfo[]  // è¤‡æ•°è·å ´å¯¾å¿œ
}

interface SimCharacter {
  // æ—¢å­˜...
  employment?: Employment
}
```

### é›‡ç”¨ã®åˆæœŸè¨­å®š

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®é›‡ç”¨çŠ¶æ…‹ã¯ `characters.json` ã§åˆæœŸè¨­å®šã™ã‚‹ã€‚

```json
{
  "id": "character_alice",
  "name": "ã‚¢ãƒªã‚¹",
  "employment": {
    "jobId": "waiter",
    "workplaces": [
      { "workplaceLabel": "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", "mapId": "town" }
    ]
  }
}
```

- **æœªé›‡ç”¨**: `employment`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’çœç•¥
- **é›‡ç”¨æ¸ˆã¿**: ä¸Šè¨˜ã®ã‚ˆã†ã«è·å ´æƒ…å ±ã‚’è¨­å®š
- **è¤‡æ•°å‹¤å‹™å…ˆ**: `workplaces`é…åˆ—ã«è¤‡æ•°ã®è·å ´ã‚’è¿½åŠ å¯èƒ½

### workã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æµã‚Œ

1. workspace ã‚¿ã‚°ã®ã‚ã‚‹å ´æ‰€ã§ work ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
2. å–¶æ¥­æ™‚é–“å†…ãªã‚‰åƒã‘ã‚‹
3. æ™‚é–“çµŒé â†’ æ™‚çµ¦ Ã— æ™‚é–“ = çµ¦æ–™ã‚’ money ã«åŠ ç®—
4. satiety â†“, energy â†“

### ãƒ•ãƒ«ã‚¿ã‚¤ãƒ /ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹

- ã‚·ã‚¹ãƒ†ãƒ ã§ã¯å³å¯†ã«å®šç¾©ã—ãªã„
- LLMãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§åˆ¤æ–­
  - ãƒ•ãƒ«ã‚¿ã‚¤ãƒ : ã€Œ9:00-17:00ã¯ã“ã“ã§åƒãã€
  - ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹: å¿…è¦ã«å¿œã˜ã¦åƒã

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©

### å‹å®šç¾©

```typescript
interface ActionDefinition {
  type: string
  duration: number              // æ‰€è¦æ™‚é–“(ms)

  // å‰ææ¡ä»¶
  requirements: {
    facilityTags?: FacilityTag[]   // å¿…è¦ãªæ–½è¨­ã‚¿ã‚°ï¼ˆANDæ¡ä»¶: ã™ã¹ã¦å¿…è¦ï¼‰
    ownership?: "self" | "any"     // æ‰€æœ‰æ¨©ï¼ˆself=è‡ªåˆ†ã®ç‰©ä»¶ã®ã¿ï¼‰
    minStats?: Partial<CharacterStats>
    cost?: "facility" | number     // æ–½è¨­æ–™é‡‘ or å›ºå®šé¡
    nearNpc?: boolean              // NPCè¿‘ãã«ã„ã‚‹å¿…è¦
    employment?: boolean           // é›‡ç”¨ã•ã‚Œã¦ã„ã‚‹å¿…è¦ï¼ˆworkã®å ´åˆï¼‰
  }

  // åŠ¹æœ
  effects: {
    stats?: Partial<CharacterStats>
    money?: number | "hourlyWage"  // å›ºå®šé¡ or æ™‚çµ¦è¨ˆç®—
    qualityBonus?: boolean         // å“è³ªã§åŠ¹æœé‡å¤‰å‹•
  }
}
```

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®šã®å¤–éƒ¨åŒ–

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ™‚é–“ã¨åŠ¹æœã¯ `world-config.json` ã® `actions` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç®¡ç†ã€‚
`definitions.ts` ã§ã¯ requirements ã¨ emoji ã®ã¿ã‚’å®šç¾©ã™ã‚‹ã€‚

```json
// world-config.json
{
  "actions": {
    "sleep": {
      "durationRange": { "min": 30, "max": 480, "default": 480 },
      "perMinute": { "energy": 0.208, "mood": 0.042 }
    },
    "eat": {
      "durationRange": { "min": 15, "max": 60, "default": 30 },
      "perMinute": { "satiety": 1.67, "mood": 0.33 }
    },
    "talk": {
      "fixed": true,
      "duration": 5,
      "effects": { "mood": 20 }
    },
    "thinking": {
      "fixed": true,
      "duration": 0,
      "effects": {}
    }
  }
}
```

### å¯å¤‰æ™‚é–“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

LLMãŒ `durationMinutes` ã‚’æŒ‡å®šå¯èƒ½ã€‚åŠ¹æœã¯ `perMinute Ã— durationMinutes` ã§è¨ˆç®—ã€‚

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | æ™‚é–“ç¯„å›² | åŠ¹æœï¼ˆ/åˆ†ï¼‰ |
|-----------|---------|-----------|
| eat | 15-60åˆ† | satiety+1.67, mood+0.33 |
| sleep | 30-480åˆ† | energy+0.208, mood+0.042 |
| bathe | 15-60åˆ† | hygiene+3.33, mood+0.5 |
| rest | 10-60åˆ† | energy+0.5, mood+0.17 |
| work | 30-480åˆ† | energy-0.33, mood-0.08 |
| toilet | 3-15åˆ† | bladder+20 |

### å›ºå®šæ™‚é–“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

`fixed: true` ã§å®šç¾©ã€‚æ™‚é–“ã¨åŠ¹æœã¯å›ºå®šã€‚

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | æ™‚é–“ | åŠ¹æœ |
|-----------|-----|------|
| talk | 5åˆ† | mood+20 |
| thinking | 0åˆ† | ãªã—ï¼ˆLLMæ±ºå®šä¸­è¡¨ç¤ºç”¨ï¼‰ |

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åŠ¹æœã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é©ç”¨

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–ã¯ã€å®Œäº†æ™‚ã®ä¸€æ‹¬é©ç”¨ã§ã¯ãªã**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é©ç”¨**ã•ã‚Œã‚‹ã€‚

#### ä»•æ§˜

1. **å¯å¤‰æ™‚é–“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: `perMinute` åŠ¹æœãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é©ç”¨ã•ã‚Œã‚‹
   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ã¯è©²å½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®é€šå¸¸æ¸›å°‘ã‚’**åœæ­¢**
   - ä»£ã‚ã‚Šã« `perMinute` ã®å€¤ã§**ç½®ãæ›ãˆ**ï¼ˆåˆç®—ã§ã¯ãªã„ï¼‰
   - `perMinute` ã§å®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯é€šå¸¸é€šã‚Šæ¸›å°‘

2. **å›ºå®šæ™‚é–“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: å®Œäº†æ™‚ã« `effects` ã‚’ä¸€æ‹¬é©ç”¨ï¼ˆå¾“æ¥é€šã‚Šï¼‰
   - çŸ­æ™‚é–“ãªã®ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é©ç”¨ã®å¿…è¦ãªã—

#### ä¾‹: sleep ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ï¼ˆ8æ™‚é–“ï¼‰

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | é€šå¸¸æ¸›å°‘ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ | å‚™è€ƒ |
|-----------|---------|-------------|------|
| energy    | -0.05/åˆ† | **+0.208/åˆ†** | perMinute ã§ç½®ãæ›ãˆ |
| mood      | -0.02/åˆ† | **+0.042/åˆ†** | perMinute ã§ç½®ãæ›ãˆ |
| satiety   | -0.1/åˆ†  | -0.1/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |
| hygiene   | -0.03/åˆ† | -0.03/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |
| bladder   | -0.15/åˆ† | -0.15/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |

#### ä¾‹: work ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ï¼ˆ4æ™‚é–“ï¼‰

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | é€šå¸¸æ¸›å°‘ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ | å‚™è€ƒ |
|-----------|---------|-------------|------|
| energy    | -0.05/åˆ† | **-0.33/åˆ†** | perMinute ã§ç½®ãæ›ãˆï¼ˆæ¶ˆè€—ï¼‰ |
| mood      | -0.02/åˆ† | **-0.08/åˆ†** | perMinute ã§ç½®ãæ›ãˆï¼ˆæ¶ˆè€—ï¼‰ |
| satiety   | -0.1/åˆ†  | -0.1/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |
| hygiene   | -0.03/åˆ† | -0.03/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |
| bladder   | -0.15/åˆ† | -0.15/åˆ† | é€šå¸¸é€šã‚Šæ¸›å°‘ |

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
SimulationEngine.applyStatusDecay(elapsedMinutes)
  for each character:
    perMinute = actionExecutor.getActivePerMinuteEffects(characterId)

    for each stat (satiety, energy, hygiene, mood, bladder):
      if perMinute[stat] exists:
        // æ¸›å°‘ã‚’åœæ­¢ã—ã€perMinute ã§ç½®ãæ›ãˆ
        newValue = current + perMinute[stat] * elapsedMinutes
      else:
        // é€šå¸¸ã®æ¸›å°‘ã‚’é©ç”¨
        newValue = current - decayRate[stat] * elapsedMinutes

      clamp(newValue, 0, 100)
```

#### è¨­è¨ˆæ„å›³

- **ãƒªã‚¢ãƒ«ãªé€²è¡Œ**: ç¡çœ ä¸­ã¯å¾ã€…ã«å›å¾©ã€ä»•äº‹ä¸­ã¯å¾ã€…ã«æ¶ˆè€—
- **å‰²ã‚Šè¾¼ã¿ã®æ„å‘³**: ç¡çœ ã‚’ä¸­æ–­ã™ã‚‹ã¨å›å¾©ãŒé€”ä¸­ã§æ­¢ã¾ã‚‹
- **äºŒé‡é©ç”¨ã®é˜²æ­¢**: å®Œäº†æ™‚ã®ä¸€æ‹¬é©ç”¨ã‚’å‰Šé™¤ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã¿ã§åŠ¹æœé©ç”¨

### ç™»éŒ²ä¾‹ï¼ˆdefinitions.tsï¼‰

```typescript
const ACTIONS: Record<string, ActionDefinition> = {
  eat_home: {
    type: "eat",
    // duration ã¨ effects.stats ã¯ world-config.json ã‹ã‚‰å–å¾—
    requirements: {
      facilityTags: ["kitchen"],
      ownership: "self",
      cost: 300,  // é£Ÿæè²»
    },
    effects: {},
    emoji: "ğŸ³",
  },

  eat_restaurant: {
    type: "eat",
    requirements: {
      facilityTags: ["restaurant"],
      cost: "facility",
    },
    effects: {
      qualityBonus: true,
    },
    emoji: "ğŸ½ï¸",
  },

  work: {
    type: "work",
    requirements: {
      facilityTags: ["workspace"],
      employment: true,
    },
    effects: {
      money: "hourlyWage",
    },
    emoji: "ğŸ’¼",
  },

  thinking: {
    type: "thinking",
    // fixed: true, duration: 0 â†’ æ‰‹å‹•å®Œäº†
    requirements: {},
    effects: {},
    emoji: "ğŸ¤”",
  },
}
```

## ãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç”Ÿæˆ

### æ¦‚è¦

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã€ç¢ºç‡ã§ãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€è¨˜æ†¶ã‚’è±Šã‹ã«ã™ã‚‹ã€‚

### ãƒ•ãƒ­ãƒ¼

```
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    â†“
ç¢ºç‡åˆ¤å®šï¼ˆ20%ï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 80%: é€šå¸¸                               â”‚
â”‚ - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–: å›ºå®šå€¤                 â”‚
â”‚ - ãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰: ãªã—                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20%: LLMç”Ÿæˆ                            â”‚
â”‚ - ãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰: LLMãŒç”Ÿæˆ              â”‚
â”‚ - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–: LLMãŒæ±ºå®šï¼ˆç¯„å›²å†…ã§ï¼‰   â”‚
â”‚ - è¨˜æ†¶ã«è¿½åŠ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
interface MiniEpisodeResult {
  episode: string                    // "å…¥æµ´å‰¤ã‚’ä½¿ã£ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸ"
  statChanges: Partial<CharacterStats>  // { mood: 5 }
}

interface MiniEpisodeGenerator {
  generate(
    character: SimCharacter,
    action: ActionDefinition,
    facility: FacilityInfo | null
  ): Promise<MiniEpisodeResult | null>
}
```

### LLMå®Ÿè£…ï¼ˆå°†æ¥ï¼‰

```typescript
class LLMMiniEpisodeGenerator implements MiniEpisodeGenerator {
  async generate(character, action, facility): Promise<MiniEpisodeResult | null> {
    // 20%ã®ç¢ºç‡ã§ã®ã¿ç”Ÿæˆ
    if (Math.random() > 0.2) return null

    const result = await llm.generate({
      schema: z.object({
        episode: z.string(),
        statChanges: z.object({
          mood: z.number().min(-10).max(10).optional(),
          energy: z.number().min(-10).max(10).optional(),
          satiety: z.number().min(-10).max(10).optional(),
          hygiene: z.number().min(-10).max(10).optional(),
          bladder: z.number().min(-10).max(10).optional(),
        }),
      }),
      prompt: `
        ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: ${character.name}
        ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${action.type}
        å ´æ‰€: ${facility?.tags.join(', ') || 'ä¸æ˜'}
        ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${JSON.stringify(character.stats)}

        ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸­ã«èµ·ããŸå°ã•ãªå‡ºæ¥äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
        ãƒã‚¸ãƒ†ã‚£ãƒ–ã§ã‚‚ãƒã‚¬ãƒ†ã‚£ãƒ–ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚
      `
    })

    return result
  }
}
```

### åˆæœŸå®Ÿè£…ï¼ˆã‚¹ã‚¿ãƒ–ï¼‰

```typescript
class StubMiniEpisodeGenerator implements MiniEpisodeGenerator {
  async generate(character, action, facility): Promise<MiniEpisodeResult | null> {
    // åˆæœŸå®Ÿè£…ã§ã¯å¸¸ã«nullã‚’è¿”ã™ï¼ˆãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãªã—ï¼‰
    return null
  }
}
```

### ãƒŸãƒ‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¾‹

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¾‹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ– |
|-----------|-------------|---------------|
| bathe | å…¥æµ´å‰¤ã‚’ä½¿ã£ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸ | mood +5 |
| bathe | é•·é¢¨å‘‚ã—ã¦ã®ã¼ã›ãŸ | energy -5 |
| bathe (æ¸©æ³‰) | å¸¸é€£ã¨ä¸–é–“è©±ã‚’ã—ãŸ | mood +3 |
| eat | æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è©¦ã—ã¦ç¾å‘³ã—ã‹ã£ãŸ | mood +5 |
| eat | æ–™ç†ãŒå†·ã‚ã¦ã„ãŸ | mood -3 |
| work | åŒåƒšã«è¤’ã‚ã‚‰ã‚ŒãŸ | mood +10 |
| work | å°ã•ãªãƒŸã‚¹ã‚’ã—ã¦ã—ã¾ã£ãŸ | mood -5 |
| sleep | è‰¯ã„å¤¢ã‚’è¦‹ãŸ | mood +5 |
| sleep | æ‚ªå¤¢ã§ç›®ãŒè¦šã‚ãŸ | energy -10 |
| rest | ç¶ºéº—ãªæ™¯è‰²ã‚’è¦‹ã¤ã‘ãŸ | mood +5 |

## LLMã¨ã®é€£æº

### è¡Œå‹•æ±ºå®š

#### LLMã¸ã®å…¥åŠ›

- ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- ç¾åœ¨åœ°ã§åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- å‘¨å›²ã®æ–½è¨­æƒ…å ±
- 1æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- é›‡ç”¨æƒ…å ±

#### LLMã‹ã‚‰ã®å‡ºåŠ›

- é¸æŠã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- ç§»å‹•å…ˆï¼ˆmoveã®å ´åˆï¼‰
- ç†ç”±ï¼ˆãƒ­ã‚°ç”¨ï¼‰

### LLMã«ä»»ã›ã‚‹éƒ¨åˆ†

- å‹¤å‹™ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ•ãƒ«ã‚¿ã‚¤ãƒ /ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ï¼‰
- è¡Œå‹•ã®å„ªå…ˆé †ä½
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹•çš„å¤‰æ›´
